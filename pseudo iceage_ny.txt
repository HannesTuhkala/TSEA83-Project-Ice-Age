CONST joystick 66 -- 01000010
CONST still 0 -- 000
CONST up 7  -- 111
CONST right 5 -- 101
CONST down 6 -- 110
CONST left 4 -- 100
CONST wait_time 1000 -- not sure yet, TODO!
CONST line_goal_reached 0 -- not sure yet, TODO!
CONST player_start_position 0 -- not sure yet, TODO!

CONST var_dir 0 -- 0000 0000
CONST var_count 1 -- 0000 0001
CONST var_temp 2 -- 0000 0010
CONST var_tile 3 -- 0000 0011

L1:
	CMP joystick, still 								--z set high if no joystick signal	--L1
	MOVE joystick, var_dir
	NOP													--allow vardir to settle for comparison
	BRF L1 Z											--keep waiting for joystick values		
	CMP var_dir, up
	NOP													--allow flag to settle before branch
	BRF L2 Z
	CMP var_dir, right
	NOP													--allow flag to settle before branch
	BRF L3 Z
	CMP var_dir, down
	NOP 												--allow flag to settle before branch
	BRF L4 Z
	BRA L5
L6:
	MOVE wait_time var_count							--L6
	NOP													--allow var_count to settle for comparison
	NOP													--allow var_count to settle for comparison
L7:
	SUB var_count IMED 1 var_count						--L7
	NOP													--allow flag to settle before branch
	BRF L8 Z
	NOP													--dodge unconditional branch
	BRA L7
L8:
	CMP var_dir DIR up									--L8	-NC
	NOP 												--allow flag to settle before branch
	BRF L2.2 Z
	CMP var_dir right
	NOP													--allow flag to settle before branch
	BRF L3.2 Z
	CMP var_dir down 
	NOP													--allow flag to settle before branch
	BRF L4.2 Z
	NOP													--dodge unconditional branch 
	BRA L5.2
L2:
	COL (PCRaddr) to var_tile							--L2			--up
	NOP													--allow var_tile to settle for comparison
	NOP													--allow var_tile to settle for comparison
	CMP var_tile IMED 3 								--goal
	NOP													--allow flag to settle before branch
	BRF Line_goal_reached Z
	CMP var_tile IMED 2 								--reached ground
	NOP													--allow flag to settle before branch
	BRF L1 Z
	CMP PCR, $10
	NOP													--allow flag to settle before branch
	BRF L1 N											--hit ceiling 
	NOP													--dodge sub
	SUB PCR IMED 16 var_temp
	NOP													--allow var_temp to settle before tile_access
	NOP													--allow var_temp to settle before tile access
	COL temp var_tile
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 1									--hit rock
	NOP													--allow flag to settle before branch
	BRF L1 Z
	NOP													--dodge sub
	SUB PCR IMED 16 PCR
	MOVE $E0 PCD
	BRA L6
	NOP													--dodge sub
L2.2:
	SUB pcd IMED 16 pcd									--L2.2
	NOP													--allow flag to settle before branch
	BRF L2 Z
	NOP													--dodge unconditional branch
	BRA L6
L3:
	COL (PCRaddr) to var_tile							--L3
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 3 								--goal
	NOP													--allow flag to settle before branch
	BRF L9 Z 
	CMP var_tile IMED 2							 		--reached ground
	NOP													--allow flag to settle before branch
	BRF L1 Z
	SHIFT PCR var_temp
	NOP													--allow var_temp to settle before comp
	NOP													--allow var_temp to settle before comp
	CMP var_temp IMED $F0
	NOP													--allow flag to settle before branch
	BRF L1 Z											--hit right wall
	NOP													--dodge add
	ADD PCR IMED 1 var_temp
	NOP													--allow var_temp to settle before tile_access
	NOP													--allow var_temp to settle before tile_access
	COL var_temp var_tile
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 1									--hit rock
	NOP													--allow flag to settle before branch
	BRF L1 Z
	NOP													--dodge assignment
	MOVE 1 PCD
	BRA L6
L3.2:
	CMP pcd IMED 16 									--L3.2
	NOP													--allow flag to settle before branch
	BRF L3 Z
	CMP pcd IMED 15
	NOP													--allow flag to settle before branch
	BRF L3.3 Z
	NOP													--dodge add
	ADD pcd IMED 1 pcd
	BRA L6
	NOP													--dodge assignment
L3.3:
	MOVE 0 pcd											--L3.3
	ADD PCR IMED 1 PCR
	BRA L6
L4:
	COL (PCRaddr) to var_tile							--L4
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 3 								--goal
	NOP													--allow flag to settle before branch
	BRF Line_goal_reached Z 
	CMP var_tile IMED 2 								--reached ground
	NOP													--allow flag to settle before branch
	BRF L1 Z
	MOVE $EF var_temp
	NOP													--allow var_temp to settle before comp
	NOP													--allow var_temp to settle before comp
	CMP var_temp DIR PCR
	NOP													--allow flag to settle before branch
	BRF L1 N											--hit floor
	ADD PCR IMED 16 var_temp
	NOP													--allow var_temp to settle before tile_access
	NOP													--allow var_temp to settle before tile_access
	COL temp var_tile
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 1									--hit rock
	NOP													--allow flag to settle before branch
	BRF L1 Z
	NOP													--dodge assignment
	MOVE $10 PCD
	BRA L6
	NOP													--dodge add
L4.2:
	ADD pcd IMED 16 pcd									--L4.2
	NOP													--allow flag to settle before branch 
	BRF L4.3 N
	NOP													--dodge unconditional branch
	BRA L6
	NOP													--dodge add
L4.3:
	ADD PCR IMED 16 PCR									--L4.3
	BRA L4
L5:
	COL (PCRaddr) to var_tile							--L5
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 3 								--goal
	NOP													--allow flag to settle before branch
	BRF L9 Z var_tile, 2 								--reached ground
	CMP var_tile IMED 2 								--reached ground
	NOP													--allow flag to settle before branch
	BRF L1 Z
	SHIFT PCR var_temp
	NOP													--allow var_temp to settle before comp
	NOP													--allow var_temp to settle before comp
	CMP var_temp IMED 0
	NOP													--allow flag to settle before branch
	BRF L1 Z 											--hit left wall
	SUB PCR IMED 1 var_temp
	NOP													--allow var_temp to settle before tile_access
	NOP													--allow var_temp to settle before tile_access
	COL temp var_tile
	NOP													--allow var_tile to settle before comp
	NOP													--allow var_tile to settle before comp
	CMP var_tile IMED 1									--hit rock
	NOP													--allow flag to settle before branch
	BRF L1 Z
	NOP													--dodge sub
	SUB PCR IMED 1 PCR
	MOVE $0F PCD
	BRA L6
L5.2:
	CMP PCD IMED 0										--L5.2
	NOP													--allow flag to settle before branch
	BRF L5 Z
	NOP													--dodge sub
	SUB PCD IMED 1 PCD
	BRA L6
	NOP													--dodge assignment
L9:
	MOVE player_start_position PCR						--L9
	BRA L1												--restart game
